---
description: Workflow for debugging toolui by running it and checking logs
globs: "*.ts, *.tsx"
alwaysApply: false
---

# Debugging Workflow

When debugging UI issues, animations, or timing problems in toolui:

## 1. Create a Minimal Test Config

Create a temporary config file with only the tools needed to reproduce the issue:

```bash
# Create toolui.config.debug.toml with minimal tools
```

Example minimal config:

```toml
[[tools]]
name = "test-spinner"
command = "bun"
args = ["test-scripts/progress-spinner.js"]
```

## 2. Enable Debug Logging

Add debug logging to relevant code using the debug logger:

```typescript
import { enableDebugLogging, debugLog, createDebugLogger } from "./lib/debug";

// Enable at app startup (e.g., in index.tsx)
enableDebugLogging(); // Logs to /tmp/toolui-debug.log

// Use in code
debugLog("ComponentName", "event description", { key: "value" });

// Or create a scoped logger
const log = createDebugLogger("ProcessManager");
log("stream read", { bytes: 37, waitMs: 101 });
```

## 3. Run Toolui and Capture Logs

```bash
# Run with debug config in background
bun run dev -- -c toolui.config.debug.toml &
sleep 5
kill %1 2>/dev/null || true

# Read the debug logs
cat /tmp/toolui-debug.log
```

## 4. Analyze the Logs

The log format is:
```
{timestamp} [{category}] {message} {optional_json_data}
```

Look for:
- Timing gaps (large timestamp differences)
- Missing expected events
- Unexpected sequences

## 5. Clean Up

After debugging, always:

1. Remove debug logging calls from code
2. Delete temporary config files:
   ```bash
   rm -f toolui.config.debug.toml
   rm -f /tmp/toolui-debug.log
   ```
3. Run `bun run typecheck && bun run check` to verify no debug code remains
